%\include{header}
%\begin{document}

\chapter{Experimental Procedure} \label{chap:Experimental}

In this chapter, all of the steps required to obtain a holographic image and
a reconstruction image are explained. This includes sample and slide
preparation as well as
%, which is how all of the samples used were prepared, and
an in-depth discussion of the program used to numerically reconstruct the holographic
images.

\section{Samples and Slide Preparation}

Most of the objects that were observed in the holography setup were placed on slides
%
%These objects
%needed to be between one and 100 microns in size, so that the holograms could
%be captured on the CCD\@. 
%
%The objects were placed on slides
since most of the samples were of biological origin or in a suspension. 
%Glass slides and cover slips were used. 
The glass slides and cover slips had to be properly cleaned before placement of
the object
%be placed on them for viewing, 
since dirt and other materials would degrade the
resolution of the hologram by adding in unwanted fringes that could interfere
with the fringes of the objects of interest. This was done with either lens
tissue or KimWipes\texttrademark.
%This was the only cleaning that needed to be done since the slides and cover
%slips were kept covered and in isolation as to not collect dust and dirt.
Once the slide and cover slip were cleaned they
were placed on lens paper to keep them clean.

The rest of the slide preparation was done depending on the object that was to be
viewed. If the sample did not need to be put into a suspension or solution,
the object could be placed directly on the slide with a cover slip on top to
secure it.
If the object needed a suspension, then a well had to be made on the slide
using vacuum grease.
This was done to make a seal between the
slide and the cover slip, while also allowing liquid to stay in-between the two
surfaces. Vacuum grease was used since it was very stable and provided enough
adhesion to hold the cover slip in place.
This was a delicate procedure since any part of the slide touched by the
vacuum grease was rendered useless for hologram recording and image reconstruction. The vacuum
grease was usually applied with a toothpick, and a
sample well is shown in Figure~\ref{fig:well}.

\begin{figure}[htbp!]
\begin{center}
    \includegraphics[scale=0.05]{pictures/well.jpg}
\end{center}
\caption{A microscope slide with a well made out of vacuum grease.}
\label{fig:well}
\end{figure}

The suspension had to be created by diluting the material that was to be
observed.
The final solution needed to be
sparsely populated with the sample so that there was enough material
for a reconstruction to be done, but not so much material so that there
was an excessive density of fringes and image reconstruction was not possible.
%
%This was done by taking the sample, and placing a small amount in a
%large amount of water. This new solution could be further diluted by taking
%some of the solution and placing it in more water.
%
The sample could be diluted as many
times as needed to obtain a usable solution since until the reconstructions were
calculated, it was not known whether or not the solution was usable.
This procedure was required for most of the
samples used %(picture)
and a sample slide is shown in Figure~\ref{fig:solutionSlide}.
The slide could then be
placed on the slide holder %(picture)
as shown in Figure~\ref{fig:slideHolder}.

The sample objects
needed to be between 1 and 100 microns in size so that the holograms could
be captured on the CCD\@. The objects ranged from water obtained from the
Charles River (Boston, Massachusetts) to five micron colloidal diamond
particles. The identity of the objects was not always known, but this was not
a requirement since the formation of a valid hologram was the primary objective
of this work.

%PICTURE OF SOLUTION SLIDE HERE
\begin{figure}[htbp!]
\begin{center}
    \includegraphics[scale=0.05]{pictures/solution.jpg}
\end{center}
\caption{A well that was filled with solution and had a cover slip placed on
top to seal the solution in.}
\label{fig:solutionSlide}
\end{figure}
%
%Typically, to get the right solution, many dilutions need to be made. For most
%of the samples, four or five dilutions were made before any imaging was done,
%that way it was easy to image, since usually one of the dilutions made would be
%sparse enough for imaging. The dilution ratio was not important, since the only
%objective was to get a sparsely populated hologram. One pipette of solution was
%used for every 10 pipettes of distilled water used for a typical dilution.
%After the solution was made, it was pipetted into the well taking care to
%avoid air bubbles. Bubbles can appear in holograms and take away from your
%resolution, sometimes covering up the material you want to image. After the
%solution was in the well, the cover slip was place on until it was nicely
%sealed so that none of the solution would leak out. 
%
%The slide could then be
%placed on the slide holder%(picture)
%, shown in Figure~\ref{fig:slideHolder}

%The sample objects
%needed to be between 1 and 100 microns in size so that the holograms could
%be captured on the CCD\@. The objects ranged from water obtained from the
%Charles River (Boston, Massachusetts) to five micron colloidal diamond
%particles. The identity of the objects was not always known, but this was not
%a requirement since the formation of a valid hologram was the primary objective
%of this work.
%
\begin{figure}[htbp!]
\begin{center}
    \includegraphics[scale=0.05]{pictures/slideHolder.jpg}
\end{center}
\caption{The slide holder made to easily place and adjust the slide
after preparation. The slide was held in place with double-sided tape.}
\label{fig:slideHolder}
\end{figure}


\section{Recording the Holograms}

After the slides were prepared a hologram could be recorded of the object. 
%The laser must first be turned on. Once the beam is on, 
All of the components were
aligned so that the laser passed through the first objective lens, the object,
the second objective lens, and was captured by the CCD\@. Fine
adjustments of the components using the three-axis mounts were required to
align all of the optical
components properly.
%Once all of the components are lined up, 
%The object was then moved to an area of
%interest within the solution or sample.
%
%This was done so that the resolution can
%be maximized, and to make sure that the object that was intended for viewing
%was
%in frame. At times, the object needed to be moved because in the currently
%viewed portion of the solution, there were too many objects, and the
%overcrowding would result in no possible reconstruction, since there were too
%many fringes.

%Once an appropriate object was in place 
The CCD was then moved to the focal point of the second objective
lens
%
%the second objective and the CCD could be moved. This was done to
%find the focal point of the second objective lens. 
and the object adjusted toward or away from the objective lens to create well
defined fringes
required for the formation of a hologram.
%which lead to the reconstructions. 
Next, the camera was aligned to get as much of the
hologram as possible projected onto the CCD\@. The fringe density was an
important consideration to obtaining a high quality hologram.
%, and had to be paid
%attention to. 
If there were too many fringes,
there would be a loss in resolution even to the point
%, sometimes so much so no
where reconstruction was not possible. 
If there were not enough fringes, again there could be a loss of
resolution or a meaningful reconstruction became impossible. 
%Once the setup was properly
%aligned, a hologram could be taken. 
After the hologram was recorded a
background image was also recorded with the sample removed from the beam path
in order to remove artifacts associated with the background signal.
%needed so that the background could be subtracted later on
%from the hologram.
Once all of the images had been recorded on the
CCD, the memory card was removed from the camera and the data was analyzed numerically.

\section{Analyzing the Holograms}

%Once the digital images have been recorded, they were transfered into a computer for
%analysis. 
The digital images were recorded in a RW2 format, which is the raw,
lossless format used by the camera.
%This was done to ensure that
%no information was lost to the compression of the photos in the camera.
%Therefore, the images had to be converted to a workable, yet still lossless
%format.
Since the RW2 format is difficult to work with in a programming language,
the images had to be converted into a more programming friendly format.
%to a different format to overcome the limitations of the RW2 format.
%Since these image files were large (approximately 70 megabytes each), the images had to be reduced in size to
%overcome the limitations in memory and computation time.
A lossless format was used so that none of the fringe information in the image
would be lost in the compression process. 
The raw images were converted into TIFF images using DCRaw~\cite{DCRaw},
an
open-source program available for all platforms. The following command was
used to convert all the RW2 files into a 16-bit TIFF file.

\begin{center}
\begin{lstlisting}[frame=none, language=bash, numbers=none]
dcraw -6 -T *.RW2
\end{lstlisting}
\end{center}
The -6 parameter sets the program to write 16 bits per sample and
-T sets the output to be TIFF format.
16-bit TIFF files were used since the RW2 format saves the image information in
12-bits
%was a 12-bit format, 
and using
anything less than 12-bits would lose some information recorded using the RW2
format.
%since this format was lossless and easily usable in Python.
%since this format minimized the amount of information when reducing from MB to
%70 megabytes.
%TIFF images
%are preferable over most other formats, but PNG could also be used. 16-bit TIFF
%files cannot be viewed by most programs, so a more typical approach is to go
%with the 8-bit TIFF files. RW2 is not the only type of raw
%file, but DCRaw covers most raw formats that will be produced.

%Now that the images had been converted to a workable format, the
%reconstruction calculation could be performed. 
The reconstruction calculation was done with HoloPy,
an open-source module in Python developed by Tom Dimiduk et al.\cite{Manoharan} of the Manoharan Group at
Harvard University. A sample of the code is shown in
Listing~\ref{listing:code}. For every image reconstruction, there was a separate
piece of code for that specific hologram so that the conditions used to create
that reconstruction were kept and so that the hologram could easily be
reconstructed at any later time.


\lstset{frame=tb,
  language=Python,
  aboveskip=3mm,
  belowskip=3mm,
  showstringspaces=false,
  columns=flexible,
  basicstyle={\small\ttfamily},
  %numbers=none,
  numberstyle=\tiny\color{gray},
  keywords=[2]{as},
  keywordstyle=\color{blue},
  commentstyle=\color{dkgreen},
  stringstyle=\color{mauve},
  breaklines=true,
  breakatwhitespace=true
  tabsize=3
}

\begin{Code}[scale=0.75,htbp!]
    \centering
\begin{lstlisting}[caption=Code for a general reconstruction, label=listing:code]
import holopy as hp
import numpy as np
import matplotlib.pyplot as plt

#Set the magnification of the second objective
magnification = 20

#Get the spacing between pixels
Spacing = 6.8/magnification

#Set the optics of the system
optics = hp.core.Optics(wavelen=.66, index=1.33, polarization=[1.0, 0.0])

#Get the background image so that it may be subtracted 
#off to give a better reconstruction
bg = hp.load('backgroundImage.tiff', spacing=Spacing, optics=optics)

#Load the object image
obj = hp.load('objectHologram.tiff', spacing=Spacing, optics=optics)

#Get the distances to reconstruction the image at
d = np.linspace(400, 600, 5)

#Create the hologram to be reconstructed with the background 
#subtracted off
holo = obj - bg

#Display the hologram before reconstruction
hp.show(holo)
plt.show()

#Do the reconstruction
rec = hp.propagate(holo, d)

#Display the hologram after reconstruction
hp.show(rec)
plt.show()

\end{lstlisting}
\end{Code}

The advantage of using HoloPy was simplicity of use. The first 3
lines of Listing~\ref{listing:code} are import statements required for loading
the necessary computational modules.
%which loads in the
%modules that we will need.
NumPy is a scientific library and MatPlotLib is a
library 
%that allows 
for visualization of the data. Next, the magnification
of the second objective lens was input
%, which was needed 
to set the pixel spacing
calibration for quantitative work.
%is set. This was so that the spacing between the
%pixels can be set.
%The spacing was set so that when the reconstructions were done, measurements
%could
%be accurately taken of the reconstructed objects. 
The optics of the system were set next providing
%, which allows for 
information such as the wavelength and the index of
refraction. Since the slides were composed of standard glass, the refractive
index was 1.33 for all hologram reconstructions.

%Since glass was used in the slides, the refractive index
%for glass was used, which was set to be 1.33 for all of the holograms.

%\begin{Code}[scale=0.75,htbp!]
%    \centering
%\begin{lstlisting}[caption=Timing of a typical run of the code,
%label=listing:time]
%IPython CPU timings (estimated):
%Total runs performed: 2
%  Times  :      Total      Per run
%  User   :      59.33 s,      29.66 s.
%  System :       2.03 s,       1.02 s.
%Wall time:      61.84 s.
%\end{lstlisting}
%\end{Code}

Next, the background and object hologram images were
loaded into memory along with the spacing and optics parameters. 
%passed so that all the
%information was with the loaded images. The next thing was to get the distances
%at which the reconstruction was to be done at. This was done with 
Subsequently, the NumPy
function \emph{linspace}, which took the parameters of a start point, a stop
point, and how many points in between was loaded to set the
location of the reconstruction plane.
%All of these parameters vary
%depending on the images. 
One limiting factor of the complexity of calculation that could be performed
was the amount of random access
memory, or RAM, that the computer had. The number of slices in the
reconstruction and the resolution of the images were the dominant factors
determining how much RAM was needed. A typical run took required around 6
gigabytes of RAM.
%, which was why the parameters must be
%manipulated to achieve optimum results in runtime. 
Next, the background image was
subtracted from the object hologram image.
%
%This allowed for a higher contrast image,
%as it got rid of the fringes from the material that was in the image that was not
%desired. This included things such as dust or dirt that may have been on the
%CCD or the other optical parts in the system, or on the slides themselves.
%
The background subtracted hologram image was then shown to the user as
%This was to make
%sure that all of the right information has been given to the program. 
%This was just 
a reality check and was not needed after the first run.


Finally, the hologram image was
reconstructed. This was done by passing the background subtracted hologram and
the distances at which the hologram was to be reconstructed to the function
\emph{propagate}. This step was where the program took the most amount of time
and a timing
of a typical run of the program is shown in Listing~\ref{listing:time}. 
Listing~\ref{listing:time} shows the total time it took for the program to run
twice, and the time per run.
After this,
the reconstruction was plotted and all the slices could be viewed by pressing the
arrow keys. A useful functionality of HoloPy was that when the user left or right
clicked on the image the coordinates were printed. These coordinates were both
the pixel and spacing coordinates, which allowed for measurements to be quickly
obtained.



\begin{Code}[scale=0.75,htbp!]
    \centering
\begin{lstlisting}[caption=Timing of a typical run of the code,
label=listing:time]
IPython CPU timings (estimated):
Total runs performed: 2
  Times  :      Total      Per run
  User   :      59.33 s,      29.66 s.
  System :       2.03 s,       1.02 s.
Wall time:      61.84 s.
\end{lstlisting}
\end{Code}














%\bibliographystyle{plain}
%\bibliography{HonoursBiblio/HonoursBiblio.bib}
%\end{document}
