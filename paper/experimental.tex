%\include{header}

%\begin{document}

\chapter{Experimental Procedure} \label{chap:Experimental}

\section{Samples and Slide Preparation}

Most of the objects that was observed were placed on slides. These objects
needed to be between one and 100 microns in size, so that the holograms could
be captured on the CCD\@. The objects were placed on slides
since most of the samples were of biological origin or in a suspension. Glass slides and
cover slips were used. These had to be properly cleaned before any object could
be placed on them for viewing, since dirt and other materials would degrade the
resolution of the hologram by adding in unwanted fringes that could interfere
with the fringes of the objects of interest. This was done with either lens tissue or Kimwipes.
This was the only cleaning that needed to be done since the slides and cover
slips were kept covered and in isolation as to not collect dust and dirt.
Once the slide and cover slip were cleaned, they
were placed on lens paper, which was done to keep them clean, and not pick up
any dirt off of the table.

The rest of the slide preparation was done depending on the object that was to be
viewed. If the sample did not need to be put in a suspension or solution, then
the object could be placed directly on the slide, with the cover slip on top to
secure it.
If the object needed a suspension, then a well had to be made on the slide. The
well was made out of vacuum grease. This was done to make a seal between the
slide and the cover slip, while also allowing liquid to stay in-between the two
surfaces. Vacuum grease was used since it wa very stable and provided enough
adhesion to hold on the cover slip.
The well is shown in Figure~\ref{fig:well}.
This was a delicate procedure, since any part of the slide touched by the
vacuum grease was rendered useless for reconstruction. The vacuum
grease was usually applied with a toothpick.

\begin{figure}[htbp!]
\begin{center}
    \includegraphics[scale=0.05]{pictures/well.jpg}
\end{center}
\caption{A slide with a well made out of vacuum grease.}
\label{fig:well}
\end{figure}

The suspension had to be created by diluting the material that was to be
observed. This was done by taking the sample, and placing a small amount in a
large amount of water. This new solution could be further diluted by taking
some of the solution and placing it in more water. This could be done as many
times as needed to obtain a usable solution. Until the reconstructions were
made, whether or not the solution was usable was not easily known.  The final solution needs to be
sparsely populated with the original sample, that way there is enough material
so that a reconstruction can be done, but not too much material so that there
are too many fringes and nothing can be resolved. This was done for most of the
samples used%(picture)
, and a sample slide is shown in Figure~\ref{fig:solutionSlide}.

%PICTURE OF SOLUTION SLIDE HERE
\begin{figure}[htbp!]
\begin{center}
    \includegraphics[scale=0.05]{pictures/solution.jpg}
\end{center}
\caption{A well that was filled with solution and had a cover slip placed on
top to seal the solution in.}
\label{fig:solutionSlide}
\end{figure}

Typically, to get the right solution, many dilutions need to be made. For most
of the samples, four or five dilutions were made before any imaging was done,
that way it was easy to image, since usually one of the dilutions made would be
sparse enough for imaging. The dilution ratio was not important, since the only
objective was to get a sparsely populated hologram. One pipette of solution was
used for every 10 pipettes of distilled water used for a typical dilution.
After the solution was made, it was pipetted into the well taking care to
avoid air bubbles. Bubbles can appear in holograms and take away from your
resolution, sometimes covering up the material you want to image. After the
solution was in the well, the cover slip was place on until it was nicely
sealed so that none of the solution would leak out. The slide could then be
placed on the slide holder%(picture)
, shown in Figure~\ref{fig:slideHolder}

%PICTURE OF SLIDE HOLDER
\begin{figure}[htbp!]
\begin{center}
    \includegraphics[scale=0.05]{pictures/slideHolder.jpg}
\end{center}
\caption{The slide holder that was made to easily place and adjust the slide
after preparation. The slide is held on with double-sided tape.}
\label{fig:slideHolder}
\end{figure}


\section{Recording the Holograms}

After the slides have been prepared, a hologram could be taken of the object. The
laser must first be turned on. Once the beam is on, all of the components need
to be lined up so that the laser goes through the first objective, the object,
and through the second objective, and is fully captured by the CCD\@. Fine
adjustments had to be made with the three-axis mounts to get all of the optical
components lined up properly.
Once all of the
components are lined up, the object could be moved about to find an area of
interest within the solution or sample. This was done so that the resolution can
be maximized, and to make sure that the object that was intended for viewing
was
in frame. At times, the object needed to be moved because in the currently
viewed portion of the solution, there were too many objects, and the
overcrowding would result in no possible reconstruction, since there were too
many fringes.

Once a good object
was in place, the second objective and the CCD could be moved. This was done to
find the focal point of the second objective lens. Once the focal point was found,
the object could be adjusted toward or away from the objective lens to create fringes,
which lead to the reconstructions. The camera was moved to get the most of the
hologram onto the CCD\@. The fringes were important, and had to be paid
attention to. Too many,
and there would be a loss in resolution, sometimes so much so no
reconstruction was possible. Not enough, and again, there could be a loss of
resolution or a loss of the reconstruction itself. Once the setup was properly
aligned, a hologram could be taken. After the hologram was recorded, a
background image was needed so that the background could be subtracted later on
from the hologram. Once all the images had been recorded on the
CCD, the memory card could be taken from the camera and the data could be analyzed.

\section{Analyzing the Holograms}

Once the digital images have been recorded, they were put onto a computer for
analysis. The digital images were taken in a RW2 format, which is the raw
format that the camera outputted. This was done to ensure that
no information was lost to the compression of the photos in the camera.
Therefore, the images had to be converted to a workable, yet still lossless
format. A lossless format was used so that none of the fringes in the image
would be lost in the compression process. 
The raw images were converted into TIFF images using DCRaw~\cite{DCRaw},
which is an
open-source program available for all platforms. The following command was the
one used to convert all the RW2 files into a 16-bit TIFF file.

\begin{center}
\begin{lstlisting}[frame=none, language=bash, numbers=none]
dcraw -6 -T *.RW2
\end{lstlisting}
\end{center}
The -6 is what makes the program write 16 bits per sample instead of eight, and
the -T is how we get the output to be TIFF files. 16-bit TIFF files were used
since that reduced the amount of information lost in the images.
%TIFF images
%are preferable over most other formats, but PNG could also be used. 16-bit TIFF
%files cannot be viewed by most programs, so a more typical approach is to go
%with the 8-bit TIFF files. RW2 is not the only type of raw
%file, but DCRaw covers most raw formats that will be produced.

Now that the images had been converted to a workable format, the
reconstruction could be done. The reconstruction process was done with HoloPy,
which is an open-source module in Python developed by Tom Dimiduk et al.\ at Manoharan Group at
Harvard University. A sample of the general code run is shown in
Listing~\ref{listing:code}. For every reconstruction done, there is a separate
piece of code for that specific hologram, so that the conditions used to create
that reconstruction are kept, and so that the hologram can easily be
reconstructed at any time.


\lstset{frame=tb,
  language=Python,
  aboveskip=3mm,
  belowskip=3mm,
  showstringspaces=false,
  columns=flexible,
  basicstyle={\small\ttfamily},
  %numbers=none,
  numberstyle=\tiny\color{gray},
  keywords=[2]{as},
  keywordstyle=\color{blue},
  commentstyle=\color{dkgreen},
  stringstyle=\color{mauve},
  breaklines=true,
  breakatwhitespace=true
  tabsize=3
}

\begin{Code}[scale=0.75,htbp!]
    \centering
\begin{lstlisting}[caption=Code for a general reconstruction, label=listing:code]
import holopy as hp
import numpy as np
import matplotlib.pyplot as plt

#Set the magnification of the second objective
magnification = 20

#Get the spacing between pixels
Spacing = 6.8/magnification

#Set the optics of the system
optics = hp.core.Optics(wavelen=.66, index=1.33, polarization=[1.0, 0.0])

#Get the background image so that it may be subtracted 
#off to give a better reconstruction
bg = hp.load('backgroundImage.tiff', spacing=Spacing, optics=optics)

#Load the object image
obj = hp.load('objectHologram.tiff', spacing=Spacing, optics=optics)

#Get the distances to reconstruction the image at
d = np.linspace(400, 600, 5)

#Create the hologram to be reconstructed with the background 
#subtracted off
holo = obj - bg

#Display the hologram before reconstruction
hp.show(holo)
plt.show()

#Do the reconstruction
rec = hp.propagate(holo, d)

#Display the hologram after reconstruction
hp.show(rec)
plt.show()

\end{lstlisting}
\end{Code}

The beauty of using HoloPy was the simplicity of use. The first 3
lines of Listing~\ref{listing:code} are import statements, which loads in the
modules that we will need. NumPy is a scientific library, and MatPlotLib is a
library that allows for the visualization of the data. Next, the magnification
of the second objective is set. This was so that the spacing between the
pixels can be set.
The spacing was set so that when the reconstructions were done, measurements
could
be accurately taken of the reconstructed objects. The optics of the system were
set next, which allows for information such as the wavelength and the index of
refraction to be set. Since glass was used in the slides, the refractive index
for glass was used, which was set to be 1.33 for all of the holograms.

\begin{Code}[scale=0.75,htbp!]
    \centering
\begin{lstlisting}[caption=Timing of a typical run of the code,
label=listing:time]
IPython CPU timings (estimated):
Total runs performed: 2
  Times  :      Total      Per run
  User   :      59.33 s,      29.66 s.
  System :       2.03 s,       1.02 s.
Wall time:      61.84 s.
\end{lstlisting}
\end{Code}

The background image and the object hologram image was
loaded, with the spacing and optics parameters passed so that all the
information was with the loaded images. The next thing was to get the distances
at which the reconstruction was to be done at. This was done with the NumPy
function \emph{linspace}, which took the parameters of a start point, a stop
point, and how many points in between are needed. All of these parameters vary
depending on the images. A limiting factor was the amount of random access
memory, or RAM, that the computer had. The more slices you make of the
reconstruction, the more memory needed. The resolution of the images will
determine how much memory was needed, which was why the parameters must be
manipulated to achieve optimum results in runtime. Next, the background was
subtracted from the object hologram. This allowed for a higher contrast image,
as it got rid of the fringes from the material that was in the image that was not
desired. This included things such as dust or dirt that may have been on the
CCD or the other optical parts in the system, or on the slides themselves.
The background subtracted hologram was then shown to the user. This was to make
sure that all of the right information has been given to the program. This was
just a check, and was not needed after the first run.


Finally, the hologram was
reconstructed. This was done by passing the background subtracted hologram and
the distances at which the hologram was to be reconstructed at to the function
propagate. This was where the program took the most amount of time. The timing
of a typical run of the whole program is shown in Listing~\ref{listing:time}. After this,
the reconstruction was plotted, and all the slices could be viewed by pressing the
arrow keys. A nice functionality of HoloPy was that when the user left or right
clicked on the image, the coordinates were printed. These coordinates were both
the pixel and spacing coordinates, which allowed for measurements to be quickly taken.

















%\bibliographystyle{plain}
%\bibliography{HonoursBiblio/HonoursBiblio.bib}


%\end{document}
